#!/usr/bin/env python
# -*- coding: utf-8 -*-
import json
import shutil
import sys
import time
import chardet
import os
import demjson
from CommMysql_local import CommMysql
import re
import time
from bean import Custom, Action
from datetime import datetime


reload(sys)
sys.setdefaultencoding("utf-8")

adid_list = ['835225','85976681','85645737','51000000101889','80776625','39931887','85901645','84044687','85232581','74447802','829198','85490345','51000000101890','78723804','86146162','51000000101886','85929266','84043579','79721269','69025232','62056341','47047474','65880390','85241549','83884849','86126123','com.tencent.tmgp.pubgmhd','51000000101898','85525355','85792474','com.tencent.tmgp.sgame','51000000101887','85489576','64225253','85612765','80592117','80035039','59327060','85976077','84596805','76062589','85865112','82249188','6723097408','84044711','69507533','60006230','86211518','56770464','51000000101885','198969','51000000101750','85832610','65234257','86383409','72996062','79720452','85958369','51000000101826','86188882','51000000101903','371985','76162168','77043417','60303187','83487902','70369627','86282874','85412924','85463054','818947','com.tencent.qqlive','83072555','71241358','76348078','84808977','65452798','023887','83736271','698030','73617427','232699','79708733','51000000101907','024173','81623371','84208080','com.tencent.tmgp.sskgame','84237828','84750131','com.taptap','56269326','85969744','80824535','69442091','84499340','51000000101906','78799061','80035320','72616395','54517954','85412202','85740337','51000000101829','51000000101377','85504655','85907585','86340367','51000000101883','031160','51000000101582','78337343','85752269','35042870','69507628','86204313','51000000101709','70438092','69030175','69667372','47824704','80844276','84594944','86114844','com.tencent.tmgp.cf','85384142','62806164','84811931','86120096','51000000101583','81919731','024410','54863670','81144431','74479506','51000000100880','com.tencent.tmgp.minitech.miniworld','86039649','195567','84550871','77315907','81264931','86196659','85758071','77391700','80279052','85225004','58058373','76663011','84963418','85607872','72901074','51000000101711','86219879','84902146','85641149','51000000101710','84450702','85895129','7064275504','53184760','51000000101468','85607949','84570130','86220104','51000000101333','85744139','80592984','83920449','51000000101466','86329970','86219880','85647581','100412','74477413','78879009','85980278','85424318','85461338','45823446','85254850','64221280','86226252','85607730','51000000101342','51000000101715','68795527','85936638','85447733','85548497','81888501','85683445','82249305','75894176','023768','83452841','65684648','50359719','51000000101343','59528754','421020','51000000101584','59771993','74244321','59122254','51000000100498','com.smile.gifmaker','86101933','85732152','84729165','com.tencent.tmgp.pubgm','85978023','81988747','com.jifen.qukan','77651290','82249480','81371120','81559721','51000000101473','51000000101620','17771773199','51000000101683','804212','51000000101905','86315616','78198117','51000000100899','com.tencent.tmgp.dpcq','85188109','82249143','51000000101373','86340343','81711703','85625922','51000000101126','86119551','85627458','51000000101344','85866827','75564433','65036547','74479200','com.tencent.tmgp.supercell.clashofclans','51000000101796','70465028','86049496','75473571','85450753','65227044','84759379','81657986','80173170','78596725','56120498','51000000100617','85607634','85383661','86195971','85588064','86200827','83976599','85970330','84707146','84367621','54614622','51000000100897','81564285','85684682','82946646','85909530','86234492','78869128','86209929','78202416','86249831','62877296','51000000101593','84245221','85739065','51000000101594','com.ss.android.ugc.aweme','82031726','85727500','84704585','56389398','86084077','67935491','80298618','86311850','51000000101723','78163765','84558678','75354045','com.sankuai.meituan','023769','86209909','72387878','86226228','com.qqgame.hlddz','71395072','78384963','84721801','65954537','85436278','86327072','51000000101749','85789718','70701391','84723532','83802542','81914683','80264230','64337545','82064782','84598176','84086911','85045278','82247307','83078875','75476597','85970807','85640915','69033390','77650498','86320599','054757','78300603','84706195','51000000100896','78973220','82219709','86209335','51000000101285','83435223','85397087','80827594','213332','81400412','85376146','51000000100921','100353','85948761','72227221','79602997','86213318','68550429','81101685','85035300','51000000101600','70040728','com.ss.android.article.news','85806564','85898726','83241146','com.sankuai.meituan.takeoutnew','85704508','85359332','709063','85773549','337183','84352511','80283749','85957848','51000000101467','71066391','69025294','85979581','84300121','51000000101828','81215637','51000000101836','86313972','me.ele','86209930','86240201','813328','67396487','70068806','86209907','85850947','75917697','74247646','78345116','com.tencent.qgame','86245151','86113926','60496035','49876773','6172775608','100341','85801258','51000000101782','51000000101792','66739192','86321714','52295255','84945873','86209923','78197104','51000000101286','84726641','59950889','82417749','85162340','29897346917','68924552','85450397','51000000101837','86467471','83433742','80725778','84329076','51000000100895','64112053','51000000101488','78168656','81787351','85391257','82759735','51000000101834','51000000101133','com.tencent.tmgp.dwrg','47921336','79253439','85188266','com.xunmeng.pinduoduo','86242906','65267709','86209922','67935912','86439793','83010590','6172775606','85746313','86213436','78693194','70780621','86063785','86309615','81354181','86293799','com.tencent.pao','73835483','82762935','85471888','17144195266','51094166','86084938','82091625','81888512','85842245','85806858','85753636','51000000101280','35466513','51000000101919','86128302','86209903','51000000101200','84264759','062275','84710120','85791380','84770742','77596483','367879','72355124','83962163','80591965','26050331616','86006095','86118479','2117306785','com.tencent.hyrzol','83663880','115033','212763','52911967','com.kuaiduizuoye.scan','81420075','84412632','86397144','86311137','68886890','86075340','85364718','77038686','51000000101686','51000000101784','86293807','86099806','67448489','86320159','76481244','51000000101525','com.tencent.tmgp.sgqyz','85725905','84500875','83252759','51000000101833']

def get_key_lines(readfile,writefile):
    '''
    本函数从原始数据中提取有用的日志保存到临时文件

    :param readfile: 原始数据
    :param writefile: 提炼后有用的数据
    '''
    filew = open(writefile, 'w')
    file = open(readfile,'r')
    lines = file.readlines()
    print 'lines:',len(lines)
    for line in lines:
        try:
            item_list = line.split('|')
            if item_list[6] in adid_list:
                filew.write(line)
                del adid_list[adid_list.index(item_list[6])]
        except Exception, e:
            print('exception:', e,line)
    if 'file' in locals():
        file.close()
    filew.flush()
    if 'filew' in locals():
        filew.close()

if __name__ == "__main__":
    root_dir = r'D:\qblog\data'
    file = r'file=hdfslog_comm_logsh_tj2.To_S3_comm_V1_0_4sh_4c_log-sh.MTT.AdsLogicServer.response.100-112-173-211-10017.7196921441.118.log'
    # root_dir = r'D:\download'
    dir_ori = os.listdir(root_dir)
    rfile = root_dir + '\\' + file
    wfile = root_dir + '\\useraction.txt'
    get_key_lines(rfile, wfile)